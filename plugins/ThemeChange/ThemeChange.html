<div class="profile-heading-container">
    <div class="body">
        <strong class="profile-heading">Adjust the theme</strong>
        <p>Configure how your Operator instance looks</p>
        <br>
        <h4>Alternatively override the <a href="https://github.com/preludeorg/community/tree/master/plugins/ThemeChange">Operator stylesheet</a> with your own</h4>
        <input id="custom-styles" placeholder="Add the path to your custom app.css file" onchange="loadStyleSheet()"/>
        <br><br>
        <button onclick="toggleMode()">Toggle mode</button>
    </div>
</div>
<div id="init-plugin">
    <script>
        Requests.fetchOperator('/plugin/ThemeChange', {
            method: 'GET'
        }).then(res => res.json()).then(config => {
            if(config.stylesheet){
                $('#custom-styles').val(config.stylesheet);
                $('head').append(`<link rel="stylesheet" type="text/css" href="${config.stylesheet}">`);
            } else if(config.inverted){
                document.querySelector('body').classList.add('inverted');
            }
        })
    </script>
</div>
<script>
    function toggleMode() {
        Requests.fetchOperator('/plugin/ThemeChange', {
            method: 'GET'
        }).then(res => res.json()).then(config => {
            let app = document.querySelector('body')
            config.inverted = !app.classList.contains("inverted");
            Requests.fetchOperator('/plugin/ThemeChange', {
                method: 'POST',
                body: JSON.stringify(config)
            }).then(() => {
                if (!app.classList.contains("inverted")) {
                    document.querySelector('body').classList.add('inverted');
                } else {
                    document.querySelector('body').classList.remove('inverted');
                }
            });
        });
    }
    
    function loadStyleSheet(){
        Requests.fetchOperator('/plugin/ThemeChange', {
            method: 'GET'
        }).then(res => res.json()).then(config => {
            config.stylesheet = $('#custom-styles').val();
            Requests.fetchOperator('/plugin/ThemeChange', {
                method: 'POST',
                body: JSON.stringify(config)
            }).then(() => {
                if(config.stylesheet){
                    $('head').append(`<link rel="stylesheet" type="text/css" href="${$('#custom-styles').val()}">`);
                } else {
                    location.reload();
                }
            });
        });
    }
</script>
