
<div class="profile-heading-container">
    <div class="body">
        <strong class="profile-heading">Adjust the theme</strong>
        <p>Configure how your Operator instance looks. You can customize your look by selecting a theme below.
            If you want to add your own, copy one of our 
            <a href="https://github.com/preludeorg/community/tree/master/plugins/ThemeChange/app.css">existing style sheets</a> 
            and load it in below. 
        </p>
    </div>
</div>

<div class="label-text">
    <p>Pick your theme</p>
    <div class="input-wrapper">
        <select id="themes" onchange="loadTheme()">
            <option value="" selected>Default (dark)</option>
            <option value="/home/privateducky/light.css">Light</option>
        </select>
    </div>
</div>
<input id="custom-styles" placeholder="Alternatively, if you have a custom app.css enter the absolute path below" onchange="loadCustom()"/>

<div id="init-plugin">
    <script>
        Requests.fetchOperator('/plugin/ThemeChange', {
            method: 'GET'
        }).then(res => res.json()).then(config => {
            if(config.stylesheet){
                $(`#themes option[value='${config.stylesheet}']`).attr("selected", "selected");
                $('head').append(`<link rel="stylesheet" type="text/css" href="${config.stylesheet}">`);
            }
        })
    </script>
</div>

<script>
    function loadTheme() {
        loadStyleSheet($('#themes').find(":selected").val());
    }
    
    function loadCustom(){
        loadStyleSheet($('#custom-styles').val());
    }

    function loadStyleSheet(sheet){
        Requests.fetchOperator('/plugin/ThemeChange', {
            method: 'GET'
        }).then(res => res.json()).then(config => {
            let currentStylesheet = config.stylesheet;
            config.stylesheet = sheet;
            Requests.fetchOperator('/plugin/ThemeChange', {
                method: 'POST',
                body: JSON.stringify(config)
            }).then(() => {
                console.log('removing: '+currentStylesheet)
                $(`link[rel=stylesheet][href="${currentStylesheet}"]`).remove();
                if(config.stylesheet){
                    console.log('adding: '+config.stylesheet)
                    $('head').append(`<link rel="stylesheet" type="text/css" href="${config.stylesheet}">`);
                } 
            });
        });
    }
</script>
